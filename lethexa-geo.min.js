/*! lethexa-geo 2017-01-08 Copyright by Tim Leerhoff <tleerhof@web.de> */
!function(a){"use strict";a.Ellipsoid=function(a,b){var c=a*a,d=b*b,e=(c-d)/c;this.getRadiusAt=function(a){var b=c*c,e=d*d,f=a*Math.PI/180,g=Math.cos(f),h=Math.sin(f),i=g*g,j=h*h;return Math.sqrt((b*i+e*j)/(c*i+d*j))},this.a=function(){return a},this.b=function(){return b},this.a2=function(){return c},this.b2=function(){return d},this.e2=function(){return e},this.circumferenceA=function(){return 2*Math.PI*this.a},this.circumferenceB=function(){return 2*Math.PI*this.b}},a.EARTH=new a.Ellipsoid(6378137,6356752.3142),a.SUN=new a.Ellipsoid(13925e5,13925e5),a.MERCURY=new a.Ellipsoid(2439640,2439640),a.VENUS=new a.Ellipsoid(6051590,6051590),a.MOON=new a.Ellipsoid(3476e3,3476000.3142),a.MARS=new a.Ellipsoid(3399200,3399200),a.JUPITER=new a.Ellipsoid(71492680,71492680),a.SATURN=new a.Ellipsoid(60267140,60267140),a.URANUS=new a.Ellipsoid(25557250,25557250),a.NEPTUNE=new a.Ellipsoid(24766360,24766360),a.PLUTO=new a.Ellipsoid(1148070,1148070);var b=function(a,b){return[a[0][0]*b[0]+a[0][1]*b[1]+a[0][2]*b[2],a[1][0]*b[0]+a[1][1]*b[1]+a[1][2]*b[2],a[2][0]*b[0]+a[2][1]*b[1]+a[2][2]*b[2]]},c=function(a,b,c){var d=0,e=0,f=d-a,g=e-b,h=Math.sqrt(f*f+g*g),i=Math.asin(c/h),j=Math.atan2(g,f),k=j-i,l=j+i;return{p1:[c*Math.sin(k),c*-Math.cos(k)],p2:[c*-Math.sin(l),c*Math.cos(l)],center:[-c*Math.cos(j),c*-Math.sin(j)],arclength:2*i}},d=a.EARTH,e=.001,f=2*Math.PI,g=function(a){for(;a>=f;)a-=f;for(;a<0;)a+=f;return a},h=function(a){for(;a>=Math.PI;)a-=f;for(;a<-Math.PI;)a+=f;return a},i=function(a){return[[a[0][0],a[1][0],a[2][0]],[a[0][1],a[1][1],a[2][1]],[a[0][2],a[1][2],a[2][2]]]};a.fromLonLatAltArray=function(b,c){return new a.LatLonAlt(b[1],b[0],b[2]?b[2]:0,c)},a.LatLonAlt=function(a,b,c,e){this._ellipsoid=e||d,this._lat=a,this._lon=b,this._alt=c,this._radLat=a*Math.PI/180,this._radLon=b*Math.PI/180,this._earthRadius=this._ellipsoid.getRadiusAt(a),this._sinLat=Math.sin(this._radLat),this._cosLat=Math.cos(this._radLat),this._sinLon=Math.sin(this._radLon),this._cosLon=Math.cos(this._radLon)},a.LatLonAlt.prototype.getRadius=function(){return this._earthRadius},a.LatLonAlt.prototype.getLatitude=function(){return this._lat},a.LatLonAlt.prototype.getLongitude=function(){return this._lon},a.LatLonAlt.prototype.getAltitude=function(){return this._alt},a.LatLonAlt.prototype.getDistanceToHorizon=function(){var a=this.toVec3(),b=this._earthRadius*this._earthRadius,d=a[0],e=a[1],f=a[2],g=Math.sqrt(d*d+e*e),h=f,i=g*g+h*h;if(!(i<b)){var j=c(g,h,this._earthRadius);if(void 0!==j){var k=g-j.p1[0],l=h-j.p1[1],m=Math.sqrt(k*k+l*l);return m}}},a.LatLonAlt.prototype.getAltitudeAboveHorizon=function(a){var b=this._earthRadius,c=b*b,d=this._alt,e=d*d,f=Math.sqrt(e+2*b*d),g=a-f,h=Math.sqrt(g*g+c)-b;return a<f&&(h=0),{altitude:h,distance:f}},a.LatLonAlt.prototype.getCenterWith=function(b,c){var d=(this.getLatitude()+b.getLatitude())/2,e=(this.getLongitude()+b.getLongitude())/2;return new a.LatLonAlt(d,e,c,this._ellipsoid)},a.LatLonAlt.prototype.extrapolateVector=function(b,c,d){var e=c/this._ellipsoid.a(),f=b/(this._cosLat*this._ellipsoid.b());return new a.LatLonAlt(this.getLatitude()+180*e/Math.PI,this.getLongitude()+180*f/Math.PI,this.getAltitude()+d,this._ellipsoid)},a.LatLonAlt.prototype.extrapolatePolar=function(b,c){if(b<0)throw new Error("distance should be >= 0.0, but is "+b);var d=b/this._earthRadius,e=Math.cos(c),f=Math.sin(c),g=Math.sin(d),h=Math.cos(d),i=Math.asin(this._sinLat*h+this._cosLat*g*e),j=Math.atan2(g*f,this._cosLat*h-this._sinLat*g*e)+this._radLon;return new a.LatLonAlt(180*i/Math.PI,180*j/Math.PI,this._alt,this._ellipsoid)},a.LatLonAlt.prototype.getDistanceTo=function(a){var b=Math.abs(a._radLat-this._radLat),c=Math.abs(a._radLon-this._radLon),d=Math.sin(b/2),e=Math.sin(c/2),f=d*d+this._cosLat*a._cosLat*e*e,g=2*Math.atan2(Math.sqrt(f),Math.sqrt(1-f));return this._earthRadius*g},a.LatLonAlt.prototype.getAzimutTo=function(a){var b=a._radLon-this._radLon,c=Math.sin(b),d=Math.cos(b),e=Math.atan2(a._cosLat*c,this._cosLat*a._sinLat-this._sinLat*a._cosLat*d);return g(e)},a.LatLonAlt.prototype.getElevationTo=function(a){var b=this.toRelativeVec3(a),c=Math.sqrt(b[0]*b[0]+b[1]*b[1]),d=-Math.atan2(b[2],c);return h(d)},a.LatLonAlt.prototype.toLocalTransform=function(){return[[-this._sinLon,this._cosLon,0],[-this._sinLat*this._cosLon,-this._sinLat*this._sinLon,this._cosLat],[this._cosLat*this._cosLon,this._cosLat*this._sinLon,this._sinLat]]},a.LatLonAlt.prototype.toGlobalTransform=function(){return i(this.toLocalTransform())},a.LatLonAlt.prototype.toRelativeVec3=function(a){var c=this.toVec3(),d=a.toVec3(),e=[d[0]-c[0],d[1]-c[1],d[2]-c[2]],f=this.toLocalTransform(),g=b(f,e);return g},a.LatLonAlt.prototype.fromRelativeVec3=function(c){var d=this.toVec3(),e=this.toGlobalTransform(),f=b(e,c);return a.fromVec3([f[0]+d[0],f[1]+d[1],f[2]+d[2]])},a.LatLonAlt.prototype.toLonLatAltArray=function(){return[this._lon,this._lat,this._alt]},a.LatLonAlt.prototype.toVec3=function(){var a=this._ellipsoid.a()/Math.sqrt(1-this._ellipsoid.e2()*this._sinLat*this._sinLat),b=(a+this._alt)*this._cosLat*this._cosLon,c=(a+this._alt)*this._cosLat*this._sinLon,d=((1-this._ellipsoid.e2())*a+this._alt)*this._sinLat;return[b,c,d]},a.fromVec3=function(b,c){var f,g,h,i=c||d,j=b[0],k=b[1],l=b[2],m=0,n=Math.atan2(k,j),o=0,p=Math.sqrt(j*j+k*k),q=Math.sin(m),r=Math.cos(m);do f=m,g=o,h=i.a()/Math.sqrt(1-i.e2()*q*q),m=Math.atan((l-o*i.e2()*q)/(p*(1-i.e2()))),q=Math.sin(m),r=Math.cos(m),o=p/r-h;while(Math.abs(f-m)>e||Math.abs(g-o)>e);return new a.LatLonAlt(180*m/Math.PI,180*n/Math.PI,o,i)},a.LatLonAlt.prototype.toString=function(){return""+this._lat+"°, "+this._lon+"°, "+this._alt+"m"};var j=function(a,b){var c=""+a,d=Math.pow(10,b-1);if(b<=1)return c;for(;1!==d;)c=(a<d?"0":"")+c,d/=10;return c},k=function(a,b){var c=Math.pow(10,b);return Math.floor(a*c)/c},l=function(a){var b,c;a=Math.abs(a),c=Math.floor(a);var d=c;b=a-c,a=60*b,c=Math.floor(a);var e=c;b=a-c,a=60*b,c=Math.floor(a);var f=a;return{deg:d,min:e,sec:f}};a.cvtLatitudeToDegMinSec=function(a){var b=l(Math.abs(a)),c="";return c+=j(b.deg,2)+"° ",c+=j(b.min,2)+"' ",c+=j(k(b.sec,2),2)+"''",a>=0?c+" N":c+" S"},a.cvtLongitudeToDegMinSec=function(a){var b=l(Math.abs(a)),c="";return c+=j(b.deg,3)+"° ",c+=j(b.min,2)+"' ",c+=j(k(b.sec,2),2)+"''",a>=0?c+" E":c+" W"},a.cvtLatitudeToDecimalDegrees=function(a,b){if(void 0===b)throw Error("frac is missing");var c=k(Math.abs(a),b)+"°";return a>=0?c+" N":c+" S"},a.cvtLongitudeToDecimalDegrees=function(a,b){if(void 0===b)throw Error("frac is missing");var c=k(Math.abs(a),b)+"°";return a>=0?c+" E":c+" W"},module.exports.MercatorProjection=function(){var a=180/Math.PI,b=85.0511/Math.PI;this.mapToEarth=function(c){try{var d=c[0],e=c[1],f=d/a,g=e/b;f>Math.PI&&(f=Math.PI),f<-Math.PI&&(f=-Math.PI);var h=2*Math.atan(Math.pow(Math.E,g))-.5*Math.PI;return[180*f/Math.PI,180*h/Math.PI]}catch(i){console.log(i,i.stack)}},this.earthToMap=function(c){try{var d=c[0],e=d*Math.PI/180,f=c[1],g=f*Math.PI/180,h=Math.sin(g),i=(1+h)/(1-h),j=e*a,k=.5*Math.log(i)*b;return[j,k]}catch(l){console.log(l,l.stack)}}},module.exports.LLXYProjection=function(){this.mapToEarth=function(a){return[a[0],a[1]]},this.earthToMap=function(a){return[a[0],a[1]]}},module.exports.CylinderProjection=function(){this.mapToEarth=function(a){return[180*a[0],180*Math.asin(a[1])/Math.PI]},this.earthToMap=function(a){return[a[0]/180,Math.sin(a[1]*Math.PI/180)]}},module.exports.Projector=function(a){var b=this;this.mapToEarth=function(b){return a.mapToEarth(b)},this.earthToMap=function(b){return a.earthToMap(b)},this.viewToMap=function(a,b){var c=b[0],d=b[1],e=a[0],f=a[1],g=a[2],h=a[3],i=c*(g-e)+e,j=d*(h-f)+f;return[i,j]},this.mapToView=function(a,b){var c=b[0],d=b[1],e=a[0],f=a[1],g=a[2],h=a[3],i=(c-e)/(g-e),j=(d-f)/(h-f);return[i,j]},this.cvtPtToEarth=function(a,c){var d=b.viewToMap(a,c);return b.mapToEarth(d)},this.cvtPtToView=function(a,c){var d=b.earthToMap(c);return b.mapToView(a,d)}}}("undefined"==typeof exports?this.geo={}:exports);